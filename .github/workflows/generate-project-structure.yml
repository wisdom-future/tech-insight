# .github/workflows/generate-project-structure.yml
name: ðŸ“ Generate Complete Project Structure

on:
  workflow_dispatch:
    inputs:
      include_sample_data:
        description: 'Include Sample Data'
        required: true
        default: true
        type: boolean

jobs:
  generate-structure:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Generate Project Files
        run: |
          # åˆ›å»ºç›®å½•ç»“æž„
          mkdir -p {src/{components/{common,charts,layout},views/System,router,store,utils,assets/{images,styles}},public,scripts,data/{overview,collection,analysis,action,system,reports},.github/workflows}
          
          # ç”Ÿæˆpackage.json
          cat > package.json << 'EOF'
          {
            "name": "tech-insight",
            "version": "1.0.0",
            "description": "ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“Ž",
            "type": "module",
            "scripts": {
              "dev": "vite",
              "build": "vite build",
              "preview": "vite preview",
              "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs --fix",
              "format": "prettier --write src/",
              "data:fetch": "node scripts/fetch-data.js",
              "data:validate": "node scripts/data-quality-check.js"
            },
            "dependencies": {
              "vue": "^3.4.0",
              "vue-router": "^4.2.5",
              "pinia": "^2.1.7",
              "axios": "^1.6.0",
              "dayjs": "^1.11.10",
              "echarts": "^5.4.3",
              "vue-echarts": "^6.6.1",
              "element-plus": "^2.4.4",
              "@element-plus/icons-vue": "^2.3.1",
              "lodash-es": "^4.17.21"
            },
            "devDependencies": {
              "@vitejs/plugin-vue": "^4.5.2",
              "vite": "^5.0.8",
              "tailwindcss": "^3.4.0",
              "autoprefixer": "^10.4.16",
              "postcss": "^8.4.32",
              "eslint": "^8.56.0",
              "eslint-plugin-vue": "^9.19.2",
              "prettier": "^3.1.1",
              "googleapis": "^128.0.0",
              "imagemin": "^8.0.1",
              "imagemin-mozjpeg": "^10.0.0",
              "imagemin-pngquant": "^9.0.2"
            }
          }
          EOF

          # ç”Ÿæˆvite.config.js
          cat > vite.config.js << 'EOF'
          import { defineConfig } from 'vite'
          import vue from '@vitejs/plugin-vue'
          import { resolve } from 'path'

          export default defineConfig({
            plugins: [vue()],
            base: '/tech-insight/',
            resolve: {
              alias: {
                '@': resolve(__dirname, 'src')
              }
            },
            build: {
              outDir: 'dist',
              assetsDir: 'assets',
              rollupOptions: {
                output: {
                  manualChunks: {
                    vendor: ['vue', 'vue-router', 'pinia'],
                    charts: ['echarts', 'vue-echarts'],
                    ui: ['element-plus', '@element-plus/icons-vue']
                  }
                }
              }
            },
            server: {
              port: 3000,
              host: true
            }
          })
          EOF

          # ç”Ÿæˆtailwind.config.js
          cat > tailwind.config.js << 'EOF'
          module.exports = {
            content: [
              "./index.html",
              "./src/**/*.{vue,js,ts,jsx,tsx}",
            ],
            theme: {
              extend: {
                colors: {
                  primary: {
                    50: '#eff6ff',
                    500: '#3b82f6',
                    600: '#2563eb',
                    700: '#1d4ed8',
                  },
                  success: {
                    50: '#f0fdf4',
                    500: '#22c55e',
                    600: '#16a34a',
                  },
                  warning: {
                    50: '#fffbeb',
                    500: '#f59e0b',
                    600: '#d97706',
                  },
                  danger: {
                    50: '#fef2f2',
                    500: '#ef4444',
                    600: '#dc2626',
                  }
                }
              }
            },
            plugins: []
          }
          EOF

          # ç”Ÿæˆindex.html
          cat > index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
            <meta charset="UTF-8" />
            <link rel="icon" type="image/svg+xml" href="/favicon.ico" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“Ž</title>
            <meta name="description" content="åŸºäºŽAIçš„æŠ€æœ¯æƒ…æŠ¥æ”¶é›†ã€åˆ†æžå’Œå†³ç­–æ”¯æŒç³»ç»Ÿ" />
          </head>
          <body>
            <div id="app"></div>
            <script type="module" src="/src/main.js"></script>
          </body>
          </html>
          EOF

      - name: Generate Vue Components
        run: |
          # ç”Ÿæˆä¸»å…¥å£æ–‡ä»¶
          cat > src/main.js << 'EOF'
          import { createApp } from 'vue'
          import { createPinia } from 'pinia'
          import ElementPlus from 'element-plus'
          import 'element-plus/dist/index.css'
          import * as ElementPlusIconsVue from '@element-plus/icons-vue'
          import App from './App.vue'
          import router from './router'
          import './assets/styles/main.css'

          const app = createApp(App)
          const pinia = createPinia()

          // æ³¨å†ŒElementPluså›¾æ ‡
          for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component)
          }

          app.use(pinia)
          app.use(router)
          app.use(ElementPlus)
          app.mount('#app')
          EOF

          # ç”ŸæˆApp.vue
          cat > src/App.vue << 'EOF'
          <template>
            <div id="app" class="min-h-screen bg-gray-50">
              <Header />
              <div class="flex">
                <Sidebar />
                <main class="flex-1 p-6">
                  <router-view />
                </main>
              </div>
              <Footer />
            </div>
          </template>

          <script setup>
          import Header from '@/components/layout/Header.vue'
          import Sidebar from '@/components/layout/Sidebar.vue'
          import Footer from '@/components/layout/Footer.vue'
          </script>
          EOF

          # ç”Ÿæˆè·¯ç”±é…ç½®
          cat > src/router/index.js << 'EOF'
          import { createRouter, createWebHistory } from 'vue-router'
          import Overview from '@/views/Overview.vue'
          import Collection from '@/views/Collection.vue'
          import Analysis from '@/views/Analysis.vue'
          import Action from '@/views/Action.vue'
          import Reports from '@/views/Reports.vue'

          const routes = [
            {
              path: '/',
              name: 'Overview',
              component: Overview,
              meta: { title: 'æ¦‚è§ˆæ€»è§ˆ' }
            },
            {
              path: '/collection',
              name: 'Collection',
              component: Collection,
              meta: { title: 'æ•°æ®é‡‡é›†' }
            },
            {
              path: '/analysis',
              name: 'Analysis',
              component: Analysis,
              meta: { title: 'æƒ…æŠ¥åˆ†æž' }
            },
            {
              path: '/action',
              name: 'Action',
              component: Action,
              meta: { title: 'è¡ŒåŠ¨å»ºè®®' }
            },
            {
              path: '/reports',
              name: 'Reports',
              component: Reports,
              meta: { title: 'æŠ¥å‘Šä¸­å¿ƒ' }
            }
          ]

          const router = createRouter({
            history: createWebHistory('/tech-insight/'),
            routes
          })

          export default router
          EOF

      - name: Generate Core Scripts
        run: |
          # ç”Ÿæˆæ•°æ®èŽ·å–è„šæœ¬
          cat > scripts/fetch-data.js << 'EOF'
          import { writeFileSync, mkdirSync } from 'fs'
          import { dirname } from 'path'
          import axios from 'axios'

          // Google Sheets APIé…ç½®
          const SHEETS_CONFIG = {
            config: process.env.GOOGLE_SHEETS_CONFIG_ID,
            rawdata: process.env.GOOGLE_SHEETS_RAWDATA_ID,
            intelligence: process.env.GOOGLE_SHEETS_INTELLIGENCE_ID,
            operations: process.env.GOOGLE_SHEETS_OPERATIONS_ID
          }

          // æ•°æ®èŽ·å–å‡½æ•°
          async function fetchSheetData(sheetId, range) {
            try {
              const url = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&range=${range}`
              const response = await axios.get(url)
              const jsonData = response.data.substring(47).slice(0, -2)
              return JSON.parse(jsonData)
            } catch (error) {
              console.error(`Error fetching data from sheet ${sheetId}:`, error)
              return null
            }
          }

          // ç”Ÿæˆé™æ€æ•°æ®æ–‡ä»¶
          async function generateStaticData() {
            console.log('ðŸ”„ å¼€å§‹èŽ·å–Google Sheetsæ•°æ®...')
            
            // Collectioné¡µé¢æ•°æ®
            const techDataStatus = await fetchSheetData(SHEETS_CONFIG.rawdata, 'Raw_Academic_Papers!A1:Z1000')
            const benchmarkStatus = await fetchSheetData(SHEETS_CONFIG.rawdata, 'Raw_Industry_Dynamics!A1:Z1000')
            
            // Overviewé¡µé¢æ•°æ®
            const intelligenceData = await fetchSheetData(SHEETS_CONFIG.intelligence, 'Tech_Intelligence_Master!A1:Z1000')
            
            // ç¡®ä¿ç›®å½•å­˜åœ¨
            const dataDir = 'data'
            mkdirSync(`${dataDir}/collection`, { recursive: true })
            mkdirSync(`${dataDir}/overview`, { recursive: true })
            mkdirSync(`${dataDir}/analysis`, { recursive: true })
            mkdirSync(`${dataDir}/action`, { recursive: true })
            mkdirSync(`${dataDir}/system`, { recursive: true })
            mkdirSync(`${dataDir}/reports`, { recursive: true })

            // å†™å…¥æ•°æ®æ–‡ä»¶
            if (techDataStatus) {
              writeFileSync(`${dataDir}/collection/tech-data-status.json`, JSON.stringify({
                lastUpdated: new Date().toISOString(),
                data: techDataStatus
              }, null, 2))
            }

            if (benchmarkStatus) {
              writeFileSync(`${dataDir}/collection/benchmark-status.json`, JSON.stringify({
                lastUpdated: new Date().toISOString(),
                data: benchmarkStatus
              }, null, 2))
            }

            if (intelligenceData) {
              writeFileSync(`${dataDir}/overview/kpi-metrics.json`, JSON.stringify({
                lastUpdated: new Date().toISOString(),
                data: intelligenceData
              }, null, 2))
            }

            console.log('âœ… æ•°æ®èŽ·å–å®Œæˆï¼')
          }

          generateStaticData().catch(console.error)
          EOF

          # ç”Ÿæˆæ•°æ®åº“è®¾ç½®è„šæœ¬
          cat > scripts/setup-database.js << 'EOF'
          import { google } from 'googleapis'

          // Google Sheets APIè®¤è¯
          const auth = new google.auth.GoogleAuth({
            credentials: JSON.parse(process.env.GOOGLE_SERVICE_ACCOUNT_KEY),
            scopes: ['https://www.googleapis.com/auth/spreadsheets']
          })

          const sheets = google.sheets({ version: 'v4', auth })

          // åˆ›å»ºæ•°æ®åº“è¡¨ç»“æž„
          async function createDatabaseStructure() {
            console.log('ðŸ—ï¸ å¼€å§‹åˆ›å»ºGoogle Sheetsæ•°æ®åº“ç»“æž„...')
            
            // è¿™é‡Œä¼šæ ¹æ®ä½ çš„æ•°æ®åº“è®¾è®¡åˆ›å»ºç›¸åº”çš„è¡¨ç»“æž„
            // ç”±äºŽç¯‡å¹…é™åˆ¶ï¼Œè¿™é‡Œåªå±•ç¤ºæ¡†æž¶
            
            console.log('âœ… æ•°æ®åº“ç»“æž„åˆ›å»ºå®Œæˆï¼')
          }

          createDatabaseStructure().catch(console.error)
          EOF

      - name: Generate Sample Data
        if: inputs.include_sample_data
        run: |
          # ç”Ÿæˆç¤ºä¾‹æ•°æ®
          cat > data/collection/tech-data-status.json << 'EOF'
          {
            "lastUpdated": "2025-06-23T10:00:00Z",
            "techData": {
              "academicPapers": {
                "title": "å­¦æœ¯è®ºæ–‡",
                "icon": "ðŸ“š",
                "status": "active",
                "todayCount": 45,
                "totalCount": 1250,
                "successRate": 98.5,
                "avgQualityScore": 8.2,
                "topKeywords": ["AI", "5G", "é‡å­è®¡ç®—"],
                "trendData": [30, 35, 42, 38, 45],
                "lastUpdate": "2025-06-23T09:30:00Z"
              },
              "patentData": {
                "title": "ä¸“åˆ©æ•°æ®",
                "icon": "ðŸ”¬",
                "status": "active",
                "todayCount": 78,
                "totalCount": 3420,
                "successRate": 96.8,
                "avgQualityScore": 7.9,
                "topFields": ["é€šä¿¡æŠ€æœ¯", "äººå·¥æ™ºèƒ½", "åŠå¯¼ä½“"],
                "trendData": [65, 70, 75, 72, 78],
                "lastUpdate": "2025-06-23T09:30:00Z"
              }
            }
          }
          EOF

      - name: Commit Generated Files
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add .
          git commit -m "ðŸš€ Generate complete Tech Insight project structure" || exit 0
          git push
