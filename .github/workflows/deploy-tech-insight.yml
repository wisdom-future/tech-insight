name: ğŸš€ Tech Insight System - Complete Deployment

on:
  push:
    branches: [ main ]
  workflow_dispatch:
    inputs:
      setup_mode:
        description: 'Setup Mode'
        required: true
        default: 'full'
        type: choice
        options:
        - full
        - frontend-only
        - data-only
  schedule:
    - cron: '0 0 * * *'

env:
  NODE_VERSION: '18'

jobs:
  # å•ä¸€ä»»åŠ¡ï¼šæ„å»ºå’Œéƒ¨ç½²
  build-and-deploy:
    runs-on: ubuntu-latest
    name: ğŸ—ï¸ Build and Deploy Tech Insight
    permissions:
      contents: write
      pages: write
      id-token: write
      actions: read
      pull-requests: write
      checks: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}

      - name: Create Project Structure
        run: |
          echo "ğŸ“ Creating project structure..."
          
          # åˆ›å»ºç›®å½•ç»“æ„
          mkdir -p src/{components/{common,charts,layout},views/System,router,store,utils,assets/{images,styles}}
          mkdir -p public
          mkdir -p data/{overview,collection,analysis,action,system,reports}
          
          # ç”Ÿæˆ package.json (ä¸åŒ…å« type: module)
          cat > package.json << 'EOF'
          {
            "name": "tech-insight",
            "version": "1.0.0",
            "description": "ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“",
            "scripts": {
              "dev": "vite",
              "build": "vite build",
              "preview": "vite preview"
            },
            "dependencies": {
              "vue": "^3.4.0",
              "vue-router": "^4.2.5",
              "pinia": "^2.1.7",
              "axios": "^1.6.0",
              "dayjs": "^1.11.10"
            },
            "devDependencies": {
              "@vitejs/plugin-vue": "^4.5.2",
              "vite": "^5.0.8",
              "tailwindcss": "^3.4.0",
              "autoprefixer": "^10.4.16",
              "postcss": "^8.4.32"
            }
          }
          EOF
          
          # ç”Ÿæˆ vite.config.js
          cat > vite.config.js << 'EOF'
          import { defineConfig } from 'vite'
          import vue from '@vitejs/plugin-vue'
          import { resolve } from 'path'

          export default defineConfig({
            plugins: [vue()],
            base: '/tech-insight/',
            resolve: {
              alias: {
                '@': resolve(__dirname, 'src')
              }
            },
            build: {
              outDir: 'dist',
              assetsDir: 'assets',
              emptyOutDir: true
            }
          })
          EOF
          
          # ç”Ÿæˆ postcss.config.js (CommonJSè¯­æ³•)
          cat > postcss.config.js << 'EOF'
          module.exports = {
            plugins: {
              tailwindcss: {},
              autoprefixer: {},
            },
          }
          EOF
          
          # ç”Ÿæˆ tailwind.config.js
          cat > tailwind.config.js << 'EOF'
          module.exports = {
            content: [
              "./index.html",
              "./src/**/*.{vue,js,ts,jsx,tsx}",
            ],
            theme: {
              extend: {
                colors: {
                  primary: {
                    50: '#eff6ff',
                    500: '#3b82f6',
                    600: '#2563eb',
                    700: '#1d4ed8',
                  }
                }
              }
            },
            plugins: []
          }
          EOF
          
          # ç”Ÿæˆ index.html
          cat > index.html << 'EOF'
          <!DOCTYPE html>
          <html lang="zh-CN">
          <head>
            <meta charset="UTF-8" />
            <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”§</text></svg>" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <title>ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“</title>
          </head>
          <body>
            <div id="app"></div>
            <script type="module" src="/src/main.js"></script>
          </body>
          </html>
          EOF

      - name: Create Vue Application Files
        run: |
          echo "ğŸ”§ Creating Vue.js application..."
          
          # ç”Ÿæˆ src/main.js (ç®€åŒ–ç‰ˆæœ¬)
          cat > src/main.js << 'EOF'
          import { createApp } from 'vue'
          import App from './App.vue'
          import router from './router'
          import './assets/styles/main.css'

          console.log('Starting Vue application...')

          const app = createApp(App)
          app.use(router)
          app.mount('#app')

          console.log('Vue application mounted successfully')
          EOF
          
          # ç”ŸæˆåŒ…å«ç¯å¢ƒå˜é‡çš„ src/utils/api.js
          cat > src/utils/api.js << 'EOF'
          import axios from 'axios'

          // ğŸ”§ é…ç½®åŒºåŸŸ - å°†è¢«ç¯å¢ƒå˜é‡æ›¿æ¢
          const API_BASE_URL = 'GOOGLE_APPS_SCRIPT_URL_PLACEHOLDER'

          // åˆ›å»ºaxioså®ä¾‹
          const api = axios.create({
            baseURL: API_BASE_URL,
            timeout: 15000,
            headers: {
              'Content-Type': 'application/json'
            }
          })

          // è¯·æ±‚æ‹¦æˆªå™¨
          api.interceptors.request.use(
            config => {
              console.log('APIè¯·æ±‚:', config.url, config.params)
              return config
            },
            error => {
              console.error('è¯·æ±‚é”™è¯¯:', error)
              return Promise.reject(error)
            }
          )

          // å“åº”æ‹¦æˆªå™¨
          api.interceptors.response.use(
            response => {
              console.log('APIå“åº”:', response.data)
              return response
            },
            error => {
              console.error('å“åº”é”™è¯¯:', error)
              return Promise.reject(error)
            }
          )

          // ğŸ“Š è·å–æ•°æ®é‡‡é›†çŠ¶æ€
          export const getCollectionData = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getCollectionData' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–Collectionæ•°æ®å¤±è´¥:', error)
              throw error
            }
          }

          // ğŸ“ˆ è·å–æ¦‚è§ˆæ•°æ®
          export const getOverviewData = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getOverviewData' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–Overviewæ•°æ®å¤±è´¥:', error)
              throw error
            }
          }

          // ğŸ§  è·å–åˆ†ææ•°æ®
          export const getAnalysisData = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getAnalysisData' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–Analysisæ•°æ®å¤±è´¥:', error)
              throw error
            }
          }

          // ğŸ¯ è·å–è¡ŒåŠ¨å»ºè®®æ•°æ®
          export const getActionData = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getActionData' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–Actionæ•°æ®å¤±è´¥:', error)
              throw error
            }
          }

          // ğŸ“‹ è·å–æŠ¥å‘Šæ•°æ®
          export const getReportsData = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getReportsData' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–Reportsæ•°æ®å¤±è´¥:', error)
              throw error
            }
          }

          // ğŸ”§ è·å–ç³»ç»ŸçŠ¶æ€
          export const getSystemStatus = async () => {
            try {
              const response = await api.get('', {
                params: { action: 'getSystemStatus' }
              })
              return response.data
            } catch (error) {
              console.error('è·å–ç³»ç»ŸçŠ¶æ€å¤±è´¥:', error)
              throw error
            }
          }

          export default api
          EOF
          
          # ç”Ÿæˆ src/App.vue (ç®€åŒ–ç‰ˆæœ¬)
          cat > src/App.vue << 'EOF'
          <template>
            <div id="app" class="min-h-screen bg-gray-50">
              <header class="bg-white shadow-sm border-b border-gray-200">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                  <div class="flex justify-between h-16">
                    <div class="flex items-center">
                      <h1 class="text-xl font-semibold text-gray-900">ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“</h1>
                    </div>
                  </div>
                </div>
              </header>
              
              <div class="flex">
                <aside class="w-64 bg-white shadow-sm">
                  <nav class="mt-5 px-2">
                    <router-link
                      v-for="item in navigation"
                      :key="item.name"
                      :to="item.href"
                      class="group flex items-center px-2 py-2 text-base font-medium rounded-md text-gray-600 hover:bg-gray-50"
                    >
                      <span class="mr-3">{{ item.icon }}</span>
                      {{ item.title }}
                    </router-link>
                  </nav>
                </aside>
                
                <main class="flex-1 p-6">
                  <router-view />
                </main>
              </div>
            </div>
          </template>

          <script setup>
          const navigation = [
            { name: 'Overview', title: 'æ¦‚è§ˆæ€»è§ˆ', href: '/', icon: 'ğŸ“Š' },
            { name: 'Collection', title: 'æ•°æ®é‡‡é›†', href: '/collection', icon: 'ğŸ“¥' },
            { name: 'Analysis', title: 'æƒ…æŠ¥åˆ†æ', href: '/analysis', icon: 'ğŸ§ ' },
            { name: 'Action', title: 'è¡ŒåŠ¨å»ºè®®', href: '/action', icon: 'ğŸ¯' },
            { name: 'Reports', title: 'æŠ¥å‘Šä¸­å¿ƒ', href: '/reports', icon: 'ğŸ“‹' }
          ]
          </script>
          EOF
          
          # ç”Ÿæˆè·¯ç”±æ–‡ä»¶ (ä¿æŒåŸæœ‰å†…å®¹)
          cat > src/router/index.js << 'EOF'
          import { createRouter, createWebHistory } from 'vue-router'
          import Overview from '@/views/Overview.vue'
          import Collection from '@/views/Collection.vue'
          import Analysis from '@/views/Analysis.vue'
          import Action from '@/views/Action.vue'
          import Reports from '@/views/Reports.vue'

          const routes = [
            { path: '/', name: 'Overview', component: Overview, meta: { title: 'æ¦‚è§ˆæ€»è§ˆ' } },
            { path: '/collection', name: 'Collection', component: Collection, meta: { title: 'æ•°æ®é‡‡é›†' } },
            { path: '/analysis', name: 'Analysis', component: Analysis, meta: { title: 'æƒ…æŠ¥åˆ†æ' } },
            { path: '/action', name: 'Action', component: Action, meta: { title: 'è¡ŒåŠ¨å»ºè®®' } },
            { path: '/reports', name: 'Reports', component: Reports, meta: { title: 'æŠ¥å‘Šä¸­å¿ƒ' } }
          ]

          const router = createRouter({
            history: createWebHistory('/tech-insight/'),
            routes
          })

          export default router
          EOF
        env:
          GOOGLE_APPS_SCRIPT_URL: ${{ secrets.GOOGLE_APPS_SCRIPT_URL }}

      - name: Create Components and Views
        run: |
          echo "ğŸ“¦ Creating components and views..."
          
          # åˆ›å»ºå¸ƒå±€ç»„ä»¶
          cat > src/components/layout/Header.vue << 'EOF'
          <template>
            <header class="bg-white shadow-sm border-b border-gray-200">
              <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                  <div class="flex items-center">
                    <h1 class="text-xl font-semibold text-gray-900">ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“</h1>
                  </div>
                  <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-500">{{ currentTime }}</span>
                  </div>
                </div>
              </div>
            </header>
          </template>

          <script setup>
          import { ref, onMounted, onUnmounted } from 'vue'

          const currentTime = ref('')

          let timer = null

          const updateTime = () => {
            const now = new Date()
            currentTime.value = now.toLocaleString('zh-CN')
          }

          onMounted(() => {
            updateTime()
            timer = setInterval(updateTime, 1000)
          })

          onUnmounted(() => {
            if (timer) {
              clearInterval(timer)
            }
          })
          </script>
          EOF
          
          cat > src/components/layout/Sidebar.vue << 'EOF'
          <template>
            <aside class="w-64 bg-white shadow-sm">
              <nav class="mt-5 px-2">
                <router-link
                  v-for="item in navigation"
                  :key="item.name"
                  :to="item.href"
                  class="group flex items-center px-2 py-2 text-base font-medium rounded-md"
                  :class="$route.name === item.name ? 'bg-blue-100 text-blue-700' : 'text-gray-600 hover:bg-gray-50'"
                >
                  <span class="mr-3">{{ item.icon }}</span>
                  {{ item.title }}
                </router-link>
              </nav>
            </aside>
          </template>

          <script setup>
          const navigation = [
            { name: 'Overview', title: 'æ¦‚è§ˆæ€»è§ˆ', href: '/', icon: 'ğŸ“Š' },
            { name: 'Collection', title: 'æ•°æ®é‡‡é›†', href: '/collection', icon: 'ğŸ“¥' },
            { name: 'Analysis', title: 'æƒ…æŠ¥åˆ†æ', href: '/analysis', icon: 'ğŸ§ ' },
            { name: 'Action', title: 'è¡ŒåŠ¨å»ºè®®', href: '/action', icon: 'ğŸ¯' },
            { name: 'Reports', title: 'æŠ¥å‘Šä¸­å¿ƒ', href: '/reports', icon: 'ğŸ“‹' }
          ]
          </script>
          EOF
          
          cat > src/components/layout/Footer.vue << 'EOF'
          <template>
            <footer class="bg-white border-t border-gray-200">
              <div class="max-w-7xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <p class="text-center text-sm text-gray-500">
                  Â© 2025 ICTæŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“. Powered by Vue.js & GitHub Pages.
                </p>
              </div>
            </footer>
          </template>
          EOF

          # åˆ›å»ºé€šç”¨ç»„ä»¶
          # åˆ›å»ºå®Œæ•´çš„DataCardç»„ä»¶
          cat > src/components/common/DataCard.vue << 'EOF'
          <template>
            <div :class="cardClasses" class="rounded-lg p-4 border">
              <div class="flex items-center justify-between mb-3">
                <div class="flex items-center">
                  <span class="text-2xl mr-2">{{ data.icon }}</span>
                  <h3 class="font-medium text-gray-900">{{ data.title }}</h3>
                </div>
                <span :class="statusClasses" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium">
                  {{ data.status === 'loading' ? 'åŠ è½½ä¸­' : 'æ´»è·ƒ' }}
                </span>
              </div>
              
              <div v-if="loading" class="space-y-2">
                <div class="animate-pulse">
                  <div class="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                  <div class="h-4 bg-gray-200 rounded w-1/2 mb-2"></div>
                  <div class="h-4 bg-gray-200 rounded w-2/3"></div>
                </div>
              </div>
              
              <div v-else class="space-y-2">
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">ä»Šæ—¥é‡‡é›†</span>
                  <span :class="primaryTextClass" class="text-sm font-semibold">{{ data.todayCount }} æ¡</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">æ€»è®¡</span>
                  <span class="text-sm font-semibold">{{ data.totalCount }} æ¡</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">æˆåŠŸç‡</span>
                  <span class="text-sm font-semibold text-green-600">{{ data.successRate }}%</span>
                </div>
                <div class="flex justify-between">
                  <span class="text-sm text-gray-600">{{ scoreLabel }}</span>
                  <span class="text-sm font-semibold text-orange-600">{{ scoreValue }}</span>
                </div>
              </div>
              
              <div v-if="!loading && tags.length > 0" :class="borderClass" class="mt-3 pt-3 border-t">
                <div class="text-xs text-gray-600 mb-1">{{ tagLabel }}:</div>
                <div class="flex flex-wrap gap-1">
                  <span v-for="tag in tags" :key="tag" 
                        :class="tagClasses" 
                        class="inline-flex items-center px-2 py-1 rounded text-xs">
                    {{ tag }}
                  </span>
                </div>
              </div>
            </div>
          </template>

          <script setup>
          import { computed } from 'vue'

          const props = defineProps({
            data: {
              type: Object,
              required: true
            },
            color: {
              type: String,
              default: 'blue'
            },
            loading: {
              type: Boolean,
              default: false
            }
          })

          const colorConfig = {
            blue: {
              bg: 'bg-blue-50',
              border: 'border-blue-200',
              status: 'bg-blue-100 text-blue-800',
              text: 'text-blue-600',
              tag: 'bg-blue-100 text-blue-700',
              borderClass: 'border-blue-200'
            },
            green: {
              bg: 'bg-green-50',
              border: 'border-green-200',
              status: 'bg-green-100 text-green-800',
              text: 'text-green-600',
              tag: 'bg-green-100 text-green-700',
              borderClass: 'border-green-200'
            },
            purple: {
              bg: 'bg-purple-50',
              border: 'border-purple-200',
              status: 'bg-purple-100 text-purple-800',
              text: 'text-purple-600',
              tag: 'bg-purple-100 text-purple-700',
              borderClass: 'border-purple-200'
            },
            orange: {
              bg: 'bg-orange-50',
              border: 'border-orange-200',
              status: 'bg-orange-100 text-orange-800',
              text: 'text-orange-600',
              tag: 'bg-orange-100 text-orange-700',
              borderClass: 'border-orange-200'
            },
            indigo: {
              bg: 'bg-indigo-50',
              border: 'border-indigo-200',
              status: 'bg-indigo-100 text-indigo-800',
              text: 'text-indigo-600',
              tag: 'bg-indigo-100 text-indigo-700',
              borderClass: 'border-indigo-200'
            },
            pink: {
              bg: 'bg-pink-50',
              border: 'border-pink-200',
              status: 'bg-pink-100 text-pink-800',
              text: 'text-pink-600',
              tag: 'bg-pink-100 text-pink-700',
              borderClass: 'border-pink-200'
            },
            cyan: {
              bg: 'bg-cyan-50',
              border: 'border-cyan-200',
              status: 'bg-cyan-100 text-cyan-800',
              text: 'text-cyan-600',
              tag: 'bg-cyan-100 text-cyan-700',
              borderClass: 'border-cyan-200'
            },
            yellow: {
              bg: 'bg-yellow-50',
              border: 'border-yellow-200',
              status: 'bg-yellow-100 text-yellow-800',
              text: 'text-yellow-600',
              tag: 'bg-yellow-100 text-yellow-700',
              borderClass: 'border-yellow-200'
            }
          }

          const cardClasses = computed(() => {
            const config = colorConfig[props.color] || colorConfig.blue
            return `${config.bg} ${config.border}`
          })

          const statusClasses = computed(() => {
            const config = colorConfig[props.color] || colorConfig.blue
            return config.status
          })

          const primaryTextClass = computed(() => {
            const config = colorConfig[props.color] || colorConfig.blue
            return config.text
          })

          const tagClasses = computed(() => {
            const config = colorConfig[props.color] || colorConfig.blue
            return config.tag
          })

          const borderClass = computed(() => {
            const config = colorConfig[props.color] || colorConfig.blue
            return config.borderClass
          })

          const scoreLabel = computed(() => {
            if (props.data.avgQualityScore !== undefined) return 'è´¨é‡è¯„åˆ†'
            if (props.data.avgStarRating !== undefined) return 'å¹³å‡æ˜Ÿæ•°'
            if (props.data.avgImpactScore !== undefined) return 'å½±å“åŠ›è¯„åˆ†'
            if (props.data.avgInnovationScore !== undefined) return 'åˆ›æ–°åº¦è¯„åˆ†'
            if (props.data.avgMarketImpact !== undefined) return 'å¸‚åœºå½±å“'
            if (props.data.avgInfluenceScore !== undefined) return 'å½±å“åŠ›è¯„åˆ†'
            return 'è¯„åˆ†'
          })

          const scoreValue = computed(() => {
            if (props.data.avgQualityScore !== undefined) return `${props.data.avgQualityScore}/10`
            if (props.data.avgStarRating !== undefined) return props.data.avgStarRating
            if (props.data.avgImpactScore !== undefined) return `${props.data.avgImpactScore}/10`
            if (props.data.avgInnovationScore !== undefined) return `${props.data.avgInnovationScore}/10`
            if (props.data.avgMarketImpact !== undefined) return `${props.data.avgMarketImpact}/10`
            if (props.data.avgInfluenceScore !== undefined) return `${props.data.avgInfluenceScore}/10`
            return '0'
          })

          const tags = computed(() => {
            return props.data.topKeywords || 
                   props.data.topFields || 
                   props.data.topLanguages || 
                   props.data.topSources || 
                   props.data.topCompanies || 
                   props.data.topTechnologies || 
                   props.data.topCategories || 
                   []
          })

          const tagLabel = computed(() => {
            if (props.data.topKeywords) return 'çƒ­é—¨é¢†åŸŸ'
            if (props.data.topFields) return 'æŠ€æœ¯é¢†åŸŸ'
            if (props.data.topLanguages) return 'çƒ­é—¨è¯­è¨€'
            if (props.data.topSources) return 'çƒ­é—¨æ¥æº'
            if (props.data.topCompanies) return 'é‡ç‚¹å…¬å¸'
            if (props.data.topTechnologies) return 'çƒ­é—¨æŠ€æœ¯'
            if (props.data.topCategories) return 'äº§å“ç±»åˆ«'
            return 'æ ‡ç­¾'
          })
          </script>
          EOF

          # åˆ›å»ºå›¾è¡¨ç»„ä»¶
          cat > src/components/charts/TrendChart.vue << 'EOF'
          <template>
            <div class="w-full h-full flex items-center justify-center bg-gray-50 rounded-lg">
              <div v-if="loading" class="text-gray-500">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
                <p class="mt-2 text-sm">åŠ è½½ä¸­...</p>
              </div>
              <div v-else class="text-gray-500 text-center">
                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <p class="mt-2 text-sm">è¶‹åŠ¿å›¾è¡¨</p>
              </div>
            </div>
          </template>

          <script setup>
          const props = defineProps({
            data: {
              type: Object,
              default: () => ({})
            },
            loading: {
              type: Boolean,
              default: false
            },
            height: {
              type: String,
              default: '200px'
            }
          })
          </script>
          EOF

      - name: Create View Pages
        run: |
          echo "ğŸ“„ Creating view pages..."
          
          # Overviewé¡µé¢
          cat > src/views/Overview.vue << 'EOF'
          <template>
            <div class="space-y-6">
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <h3 class="text-lg leading-6 font-medium text-gray-900">ç³»ç»Ÿæ¦‚è§ˆ</h3>
                  <div class="mt-2 max-w-xl text-sm text-gray-500">
                    <p>æŠ€æœ¯æƒ…æŠ¥å†³ç­–å¼•æ“è¿è¡ŒçŠ¶æ€æ€»è§ˆ</p>
                  </div>
                </div>
                <div class="bg-gray-50 px-5 py-3">
                  <div class="text-sm">
                    <span class="font-medium text-gray-900">çŠ¶æ€ï¼š</span>
                    <span class="text-green-600">è¿è¡Œæ­£å¸¸</span>
                  </div>
                </div>
              </div>
            </div>
          </template>
          EOF
          
          # Collectioné¡µé¢
          # Collectioné¡µé¢ - å®Œæ•´åŠŸèƒ½ç‰ˆæœ¬
          cat > src/views/Collection.vue << 'EOF'
          <template>
            <div class="space-y-6">
              <!-- é¡µé¢æ ‡é¢˜ -->
              <div class="bg-white shadow rounded-lg p-6">
                <div class="flex items-center justify-between">
                  <div>
                    <h1 class="text-2xl font-bold text-gray-900">æ•°æ®é‡‡é›†ç›‘æ§</h1>
                    <p class="mt-1 text-sm text-gray-600">æŠ€æœ¯æ•°æ®å’Œä¸šç•Œæ ‡æ†å®æ—¶ç›‘æ§çŠ¶æ€</p>
                  </div>
                  <div class="flex items-center space-x-4">
                    <button @click="refreshData" :disabled="loading" 
                            class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50">
                      <svg v-if="loading" class="animate-spin -ml-1 mr-2 h-4 w-4 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                      {{ loading ? 'åˆ·æ–°ä¸­...' : 'åˆ·æ–°æ•°æ®' }}
                    </button>
                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium" :class="systemStatus.class">
                      <span class="w-2 h-2 rounded-full mr-1.5" :class="systemStatus.dotClass"></span>
                      {{ systemStatus.text }}
                    </span>
                    <span class="text-sm text-gray-500">æœ€åæ›´æ–°: {{ lastUpdate }}</span>
                  </div>
                </div>
              </div>

              <!-- é”™è¯¯æç¤º -->
              <div v-if="error" class="bg-red-50 border border-red-200 rounded-md p-4">
                <div class="flex">
                  <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-red-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                      <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                  </div>
                  <div class="ml-3">
                    <h3 class="text-sm font-medium text-red-800">æ•°æ®è·å–å¤±è´¥</h3>
                    <div class="mt-2 text-sm text-red-700">
                      <p>{{ error }}</p>
                      <p class="mt-1">æ­£åœ¨ä½¿ç”¨ç¼“å­˜æ•°æ®æ˜¾ç¤ºï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•ã€‚</p>
                    </div>
                  </div>
                </div>
              </div>

              <!-- æŠ€æœ¯æ•°æ®ç›‘æ§åŒºåŸŸ -->
              <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“Š æŠ€æœ¯æ•°æ®ç›‘æ§åŒºåŸŸ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <!-- å­¦æœ¯è®ºæ–‡å¡ç‰‡ -->
                  <DataCard :data="techData.academicPapers" color="blue" :loading="loading" />
                  <!-- ä¸“åˆ©æ•°æ®å¡ç‰‡ -->
                  <DataCard :data="techData.patentData" color="green" :loading="loading" />
                  <!-- å¼€æºé¡¹ç›®å¡ç‰‡ -->
                  <DataCard :data="techData.openSourceProjects" color="purple" :loading="loading" />
                  <!-- æŠ€æœ¯æ–°é—»å¡ç‰‡ -->
                  <DataCard :data="techData.techNews" color="orange" :loading="loading" />
                </div>
              </div>

              <!-- ä¸šç•Œæ ‡æ†ç›‘æ§åŒºåŸŸ -->
              <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ­ ä¸šç•Œæ ‡æ†ç›‘æ§åŒºåŸŸ</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                  <!-- æ ‡æ†åŠ¨æ€å¡ç‰‡ -->
                  <DataCard :data="benchmarkData.industryDynamics" color="indigo" :loading="loading" />
                  <!-- æŠ€æœ¯åˆ›æ–°å¡ç‰‡ -->
                  <DataCard :data="benchmarkData.techInnovation" color="pink" :loading="loading" />
                  <!-- äº§å“å‘å¸ƒå¡ç‰‡ -->
                  <DataCard :data="benchmarkData.productLaunches" color="cyan" :loading="loading" />
                  <!-- äººæ‰æµåŠ¨å¡ç‰‡ -->
                  <DataCard :data="benchmarkData.talentMovement" color="yellow" :loading="loading" />
                </div>
              </div>

              <!-- è¶‹åŠ¿å›¾è¡¨åŒºåŸŸ -->
              <div class="bg-white shadow rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">ğŸ“ˆ æ•°æ®é‡‡é›†è¶‹åŠ¿</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                  <!-- æŠ€æœ¯æ•°æ®è¶‹åŠ¿å›¾ -->
                  <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">æŠ€æœ¯æ•°æ®é‡‡é›†è¶‹åŠ¿</h3>
                    <TrendChart :data="techTrendData" :loading="loading" height="200px" />
                  </div>
                  <!-- ä¸šç•Œæ ‡æ†è¶‹åŠ¿å›¾ -->
                  <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="text-sm font-medium text-gray-900 mb-3">ä¸šç•Œæ ‡æ†ç›‘æ§è¶‹åŠ¿</h3>
                    <TrendChart :data="benchmarkTrendData" :loading="loading" height="200px" />
                  </div>
                </div>
              </div>
            </div>
          </template>

          <script setup>
          import { ref, onMounted, onUnmounted, computed } from 'vue'
          import { getCollectionData } from '@/utils/api'
          import DataCard from '@/components/common/DataCard.vue'
          import TrendChart from '@/components/charts/TrendChart.vue'

          // å“åº”å¼æ•°æ®
          const loading = ref(false)
          const error = ref('')
          const lastUpdate = ref('')

          // æŠ€æœ¯æ•°æ®
          const techData = ref({
            academicPapers: {
              title: "å­¦æœ¯è®ºæ–‡",
              icon: "ğŸ“š",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              successRate: 0,
              avgQualityScore: 0,
              topKeywords: [],
              trendData: [],
              lastUpdate: ''
            },
            patentData: {
              title: "ä¸“åˆ©æ•°æ®",
              icon: "ğŸ”¬",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              successRate: 0,
              avgQualityScore: 0,
              topFields: [],
              trendData: [],
              lastUpdate: ''
            },
            openSourceProjects: {
              title: "å¼€æºé¡¹ç›®",
              icon: "ğŸ’»",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              successRate: 0,
              avgStarRating: 0,
              topLanguages: [],
              trendData: [],
              lastUpdate: ''
            },
            techNews: {
              title: "æŠ€æœ¯æ–°é—»",
              icon: "ğŸ“°",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              successRate: 0,
              avgImpactScore: 0,
              topSources: [],
              trendData: [],
              lastUpdate: ''
            }
          })

          // ä¸šç•Œæ ‡æ†æ•°æ®
          const benchmarkData = ref({
            industryDynamics: {
              title: "æ ‡æ†åŠ¨æ€",
              icon: "ğŸ­",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              criticalEvents: 0,
              avgImpactScore: 0,
              topCompanies: [],
              trendData: [],
              lastUpdate: ''
            },
            techInnovation: {
              title: "æŠ€æœ¯åˆ›æ–°",
              icon: "ğŸš€",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              breakthroughCount: 0,
              avgInnovationScore: 0,
              topTechnologies: [],
              trendData: [],
              lastUpdate: ''
            },
            productLaunches: {
              title: "äº§å“å‘å¸ƒ",
              icon: "ğŸ“±",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              majorLaunches: 0,
              avgMarketImpact: 0,
              topCategories: [],
              trendData: [],
              lastUpdate: ''
            },
            talentMovement: {
              title: "äººæ‰æµåŠ¨",
              icon: "ğŸ‘¥",
              status: "loading",
              todayCount: 0,
              totalCount: 0,
              executiveChanges: 0,
              avgInfluenceScore: 0,
              topCompanies: [],
              trendData: [],
              lastUpdate: ''
            }
          })

          // è®¡ç®—å±æ€§
          const systemStatus = computed(() => {
            if (loading.value) {
              return {
                text: 'æ•°æ®æ›´æ–°ä¸­',
                class: 'bg-yellow-100 text-yellow-800',
                dotClass: 'bg-yellow-400'
              }
            }
            
            if (error.value) {
              return {
                text: 'è¿æ¥å¼‚å¸¸',
                class: 'bg-red-100 text-red-800',
                dotClass: 'bg-red-400'
              }
            }
            
            return {
              text: 'ç³»ç»Ÿè¿è¡Œä¸­',
              class: 'bg-green-100 text-green-800',
              dotClass: 'bg-green-400'
            }
          })

          const techTrendData = computed(() => {
            return {
              labels: ['å­¦æœ¯è®ºæ–‡', 'ä¸“åˆ©æ•°æ®', 'å¼€æºé¡¹ç›®', 'æŠ€æœ¯æ–°é—»'],
              datasets: [{
                label: 'ä»Šæ—¥é‡‡é›†é‡',
                data: [
                  techData.value.academicPapers.todayCount,
                  techData.value.patentData.todayCount,
                  techData.value.openSourceProjects.todayCount,
                  techData.value.techNews.todayCount
                ],
                backgroundColor: ['#3B82F6', '#10B981', '#8B5CF6', '#F59E0B']
              }]
            }
          })

          const benchmarkTrendData = computed(() => {
            return {
              labels: ['æ ‡æ†åŠ¨æ€', 'æŠ€æœ¯åˆ›æ–°', 'äº§å“å‘å¸ƒ', 'äººæ‰æµåŠ¨'],
              datasets: [{
                label: 'ä»Šæ—¥æ›´æ–°é‡',
                data: [
                  benchmarkData.value.industryDynamics.todayCount,
                  benchmarkData.value.techInnovation.todayCount,
                  benchmarkData.value.productLaunches.todayCount,
                  benchmarkData.value.talentMovement.todayCount
                ],
                backgroundColor: ['#6366F1', '#EC4899', '#06B6D4', '#EAB308']
              }]
            }
          })

          // æ•°æ®è·å–å‡½æ•°
          const fetchData = async () => {
            loading.value = true
            error.value = ''
            
            try {
              console.log('å¼€å§‹è·å–Collectionæ•°æ®...')
              const response = await getCollectionData()
              
              if (response.success) {
                console.log('æ•°æ®è·å–æˆåŠŸ:', response.data)
                
                // æ›´æ–°æŠ€æœ¯æ•°æ®
                if (response.data.techData) {
                  Object.keys(response.data.techData).forEach(key => {
                    if (techData.value[key]) {
                      techData.value[key] = {
                        ...techData.value[key],
                        ...response.data.techData[key],
                        status: 'active'
                      }
                    }
                  })
                }
                
                // æ›´æ–°ä¸šç•Œæ ‡æ†æ•°æ®
                if (response.data.benchmarkData) {
                  Object.keys(response.data.benchmarkData).forEach(key => {
                    if (benchmarkData.value[key]) {
                      benchmarkData.value[key] = {
                        ...benchmarkData.value[key],
                        ...response.data.benchmarkData[key],
                        status: 'active'
                      }
                    }
                  })
                }
                
                lastUpdate.value = new Date(response.lastUpdated).toLocaleString('zh-CN')
                console.log('æ•°æ®æ›´æ–°å®Œæˆ')
                
              } else {
                throw new Error(response.error || 'æ•°æ®è·å–å¤±è´¥')
              }
              
            } catch (err) {
              console.error('è·å–æ•°æ®å¤±è´¥:', err)
              error.value = err.message || 'ç½‘ç»œè¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè®¾ç½®'
              
              // ä½¿ç”¨é»˜è®¤æ•°æ®
              loadDefaultData()
              
            } finally {
              loading.value = false
            }
          }

          // åŠ è½½é»˜è®¤æ•°æ®
          const loadDefaultData = () => {
            console.log('åŠ è½½é»˜è®¤æ•°æ®...')
            
            // è®¾ç½®é»˜è®¤çš„æŠ€æœ¯æ•°æ®
            techData.value = {
              academicPapers: {
                title: "å­¦æœ¯è®ºæ–‡",
                icon: "ğŸ“š",
                status: "active",
                todayCount: 45,
                totalCount: 1250,
                successRate: 98.5,
                avgQualityScore: 8.2,
                topKeywords: ["AI", "5G", "é‡å­è®¡ç®—"],
                trendData: [30, 35, 42, 38, 45, 52, 48],
                lastUpdate: new Date().toISOString()
              },
              patentData: {
                title: "ä¸“åˆ©æ•°æ®",
                icon: "ğŸ”¬",
                status: "active",
                todayCount: 78,
                totalCount: 3420,
                successRate: 96.8,
                avgQualityScore: 7.9,
                topFields: ["é€šä¿¡æŠ€æœ¯", "äººå·¥æ™ºèƒ½", "åŠå¯¼ä½“"],
                trendData: [65, 70, 75, 72, 78, 82, 76],
                lastUpdate: new Date().toISOString()
              },
              openSourceProjects: {
                title: "å¼€æºé¡¹ç›®",
                icon: "ğŸ’»",
                status: "active",
                todayCount: 23,
                totalCount: 890,
                successRate: 94.2,
                avgStarRating: 1250,
                topLanguages: ["Python", "JavaScript", "Go"],
                trendData: [18, 20, 25, 21, 23, 28, 24],
                lastUpdate: new Date().toISOString()
              },
              techNews: {
                title: "æŠ€æœ¯æ–°é—»",
                icon: "ğŸ“°",
                status: "active",
                todayCount: 156,
                totalCount: 5670,
                successRate: 99.1,
                avgImpactScore: 7.5,
                topSources: ["TechCrunch", "MIT Tech Review", "IEEE"],
                trendData: [120, 135, 148, 142, 156, 162, 158],
                lastUpdate: new Date().toISOString()
              }
            }
            
            // è®¾ç½®é»˜è®¤çš„ä¸šç•Œæ ‡æ†æ•°æ®
            benchmarkData.value = {
              industryDynamics: {
                title: "æ ‡æ†åŠ¨æ€",
                icon: "ğŸ­",
                status: "active",
                todayCount: 32,
                totalCount: 1180,
                criticalEvents: 5,
                avgImpactScore: 8.1,
                topCompanies: ["Google", "Microsoft", "Apple"],
                trendData: [25, 28, 35, 30, 32, 38, 34],
                lastUpdate: new Date().toISOString()
              },
              techInnovation: {
                title: "æŠ€æœ¯åˆ›æ–°",
                icon: "ğŸš€",
                status: "active",
                todayCount: 18,
                totalCount: 650,
                breakthroughCount: 3,
                avgInnovationScore: 8.7,
                topTechnologies: ["é‡å­è®¡ç®—", "ç”Ÿæˆå¼AI", "6Gé€šä¿¡"],
                trendData: [12, 15, 20, 16, 18, 22, 19],
                lastUpdate: new Date().toISOString()
              },
              productLaunches: {
                title: "äº§å“å‘å¸ƒ",
                icon: "ğŸ“±",
                status: "active",
                todayCount: 8,
                totalCount: 340,
                majorLaunches: 2,
                avgMarketImpact: 7.8,
                topCategories: ["AIèŠ¯ç‰‡", "äº‘æœåŠ¡", "ç§»åŠ¨è®¾å¤‡"],
                trendData: [5, 6, 9, 7, 8, 10, 9],
                lastUpdate: new Date().toISOString()
              },
              talentMovement: {
                title: "äººæ‰æµåŠ¨",
                icon: "ğŸ‘¥",
                status: "active",
                todayCount: 12,
                totalCount: 450,
                executiveChanges: 3,
                avgInfluenceScore: 8.3,
                topCompanies: ["OpenAI", "Meta", "Tesla"],
                trendData: [8, 10, 14, 11, 12, 15, 13],
                lastUpdate: new Date().toISOString()
              }
            }
            
            lastUpdate.value = new Date().toLocaleString('zh-CN')
          }

          // æ‰‹åŠ¨åˆ·æ–°æ•°æ®
          const refreshData = () => {
            fetchData()
          }

          let refreshInterval = null

          // ç»„ä»¶æŒ‚è½½æ—¶åˆå§‹åŒ–
          onMounted(() => {
            console.log('Collectioné¡µé¢æŒ‚è½½ï¼Œå¼€å§‹è·å–æ•°æ®...')
            fetchData()
            
            // è®¾ç½®å®šæ—¶åˆ·æ–°ï¼ˆæ¯5åˆ†é’Ÿï¼‰
            refreshInterval = setInterval(fetchData, 300000)
          })

          // ç»„ä»¶å¸è½½æ—¶æ¸…é™¤å®šæ—¶å™¨
          onUnmounted(() => {
            if (refreshInterval) {
              clearInterval(refreshInterval)
            }
          })
          </script>
          EOF
          
          # å…¶ä»–é¡µé¢
          cat > src/views/Analysis.vue << 'EOF'
          <template>
            <div class="space-y-6">
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <h3 class="text-lg leading-6 font-medium text-gray-900">æƒ…æŠ¥åˆ†æ</h3>
                  <p class="mt-1 text-sm text-gray-600">æŠ€æœ¯æƒ…æŠ¥æ·±åº¦åˆ†æç»“æœ</p>
                </div>
              </div>
            </div>
          </template>
          EOF
          
          cat > src/views/Action.vue << 'EOF'
          <template>
            <div class="space-y-6">
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <h3 class="text-lg leading-6 font-medium text-gray-900">è¡ŒåŠ¨å»ºè®®</h3>
                  <p class="mt-1 text-sm text-gray-600">åŸºäºæƒ…æŠ¥åˆ†æçš„å†³ç­–å»ºè®®</p>
                </div>
              </div>
            </div>
          </template>
          EOF
          
          cat > src/views/Reports.vue << 'EOF'
          <template>
            <div class="space-y-6">
              <div class="bg-white overflow-hidden shadow rounded-lg">
                <div class="p-5">
                  <h3 class="text-lg leading-6 font-medium text-gray-900">æŠ¥å‘Šä¸­å¿ƒ</h3>
                  <p class="mt-1 text-sm text-gray-600">ç”Ÿæˆå’ŒæŸ¥çœ‹å„ç±»åˆ†ææŠ¥å‘Š</p>
                </div>
              </div>
            </div>
          </template>
          EOF

      - name: Create CSS and Assets
        run: |
          echo "ğŸ¨ Creating styles and assets..."
          
          cat > src/assets/styles/main.css << 'EOF'
          @tailwind base;
          @tailwind components;
          @tailwind utilities;

          body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
          }
          EOF
          
          # åˆ›å»ºfavicon
          echo "Creating favicon..."
          # è¿™é‡Œå¯ä»¥æ·»åŠ faviconæ–‡ä»¶ï¼Œæš‚æ—¶è·³è¿‡

      - name: Create Sample Data
        run: |
          echo "ğŸ“Š Creating sample data..."
          
          cat > data/collection/tech-data-status.json << 'EOF'
          {
            "lastUpdated": "2025-06-23T10:00:00Z",
            "techData": {
              "academicPapers": {
                "title": "å­¦æœ¯è®ºæ–‡",
                "icon": "ğŸ“š",
                "status": "active",
                "todayCount": 45,
                "totalCount": 1250,
                "successRate": 98.5,
                "trendData": [30, 35, 42, 38, 45]
              },
              "patentData": {
                "title": "ä¸“åˆ©æ•°æ®", 
                "icon": "ğŸ”¬",
                "status": "active",
                "todayCount": 78,
                "totalCount": 3420,
                "successRate": 96.8,
                "trendData": [65, 70, 75, 72, 78]
              }
            }
          }
          EOF

      - name: Commit Project Files to Repository
        run: |
          echo "ğŸ’¾ æäº¤é¡¹ç›®æ–‡ä»¶åˆ°ä»“åº“..."
          
          # é…ç½®Gitç”¨æˆ·
          git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          
          # æ·»åŠ æ‰€æœ‰æ–‡ä»¶
          git add .
          
          # æ£€æŸ¥æ˜¯å¦æœ‰å˜æ›´
          if [ -n "$(git status --porcelain)" ]; then
            echo "ğŸ“ æäº¤æ–°æ–‡ä»¶..."
            git commit -m "ğŸš€ Auto-generate project structure

            - Complete Vue.js application
            - All components and configurations  
            - Ready for development"
            
            git push
            echo "âœ… æäº¤æˆåŠŸ"
          else
            echo "â„¹ï¸ æ²¡æœ‰å˜æ›´éœ€è¦æäº¤"
          fi

      - name: Replace Environment Variables
        run: |
          echo "ğŸ”§ æ›¿æ¢ç¯å¢ƒå˜é‡..."
          
          # æ˜¾ç¤ºå½“å‰æ–‡ä»¶å†…å®¹ï¼ˆè°ƒè¯•ç”¨ï¼‰
          echo "æ›¿æ¢å‰çš„api.jså†…å®¹ï¼š"
          grep -n "API_BASE_URL" src/utils/api.js
          
          # æ£€æŸ¥ç¯å¢ƒå˜é‡
          if [ -z "$GOOGLE_APPS_SCRIPT_URL" ]; then
            echo "âŒ é”™è¯¯: GOOGLE_APPS_SCRIPT_URL ç¯å¢ƒå˜é‡æœªè®¾ç½®"
            echo "å½“å‰ç¯å¢ƒå˜é‡ï¼š"
            env | grep -i google || echo "æ²¡æœ‰æ‰¾åˆ°Googleç›¸å…³ç¯å¢ƒå˜é‡"
            exit 1
          fi
          
          echo "âœ… Google Apps Script URLå·²è®¾ç½®: ${GOOGLE_APPS_SCRIPT_URL:0:50}..."
          
          # æ‰§è¡Œæ›¿æ¢
          sed -i "s|GOOGLE_APPS_SCRIPT_URL_PLACEHOLDER|$GOOGLE_APPS_SCRIPT_URL|g" src/utils/api.js
          
          # éªŒè¯æ›¿æ¢ç»“æœ
          echo "æ›¿æ¢åçš„api.jså†…å®¹ï¼š"
          grep -n "API_BASE_URL" src/utils/api.js
          
          if grep -q "PLACEHOLDER" src/utils/api.js; then
            echo "âŒ é”™è¯¯: ç¯å¢ƒå˜é‡æ›¿æ¢å¤±è´¥"
            cat src/utils/api.js | head -30
            exit 1
          fi
          
          echo "âœ… ç¯å¢ƒå˜é‡æ›¿æ¢å®Œæˆ"
        env:
          GOOGLE_APPS_SCRIPT_URL: ${{ secrets.GOOGLE_APPS_SCRIPT_URL }}

      

      - name: Install Dependencies
        run: |
          echo "ğŸ“¦ Installing dependencies..."
          npm install

      - name: Build Application
        run: |
          echo "ğŸ”¨ Building application..."
          
          # æ£€æŸ¥æ„å»ºå‰çš„æ–‡ä»¶ç»“æ„
          echo "ğŸ“ æ„å»ºå‰æ£€æŸ¥:"
          ls -la
          echo "ğŸ“ srcç›®å½•:"
          ls -la src/
          echo "ğŸ“ src/components:"
          ls -la src/components/ || echo "componentsç›®å½•ä¸å­˜åœ¨"
          
          # æ£€æŸ¥package.json
          echo "ğŸ“„ Package.json scripts:"
          cat package.json | grep -A 10 '"scripts"'
          
          # æ¸…ç†å¯èƒ½çš„ç¼“å­˜
          rm -rf node_modules/.vite
          rm -rf dist
          
          # æ‰§è¡Œæ„å»º
          echo "ğŸ”§ å¼€å§‹Viteæ„å»º..."
          npm run build -- --mode production --outDir dist
          
          # æ£€æŸ¥æ„å»ºç»“æœ
          echo "ğŸ“ æ„å»ºåæ£€æŸ¥:"
          ls -la dist/
          echo "ğŸ“„ æ„å»ºåçš„index.html:"
          cat dist/index.html
          
          # éªŒè¯å…³é”®æ–‡ä»¶å­˜åœ¨
          if [ ! -f "dist/index.html" ]; then
            echo "âŒ é”™è¯¯: dist/index.html ä¸å­˜åœ¨"
            exit 1
          fi
          
          # æ£€æŸ¥æ˜¯å¦æœ‰JSå’ŒCSSæ–‡ä»¶
          echo "ğŸ“ æ„å»ºåçš„assets:"
          ls -la dist/assets/ || echo "No assets directory"
          
          echo "âœ… æ„å»ºå®Œæˆ"
        env:
          NODE_ENV: production

      - name: Setup Pages
        uses: actions/configure-pages@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          enablement: true

      - name: Verify Build Output
        run: |
          echo "ğŸ” Verifying build output..."
          if [ ! -d "dist" ]; then
            echo "âŒ dist directory not found!"
            exit 1
          fi
          if [ ! -f "dist/index.html" ]; then
            echo "âŒ index.html not found in dist!"
            exit 1
          fi
          echo "âœ… Build verification passed"
          echo "ğŸ“Š Dist directory size:"
          du -sh dist/
          echo "ğŸ“„ Files in dist:"
          find dist/ -type f -name "*.html" -o -name "*.js" -o -name "*.css" | head -10

      - name: Upload to Pages
        uses: actions/upload-pages-artifact@v3
        with:
          path: dist/

      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4

      - name: Deployment Complete
        run: |
          echo "ğŸ‰ éƒ¨ç½²å®Œæˆï¼"
          echo "ğŸŒ è®¿é—®åœ°å€: ${{ steps.deployment.outputs.page_url }}"
